@model ContactsManagement.DTOs.Contact.ContactDTO

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    :root {
        --custom-radius: 12px; /* Độ bo góc chuẩn giống trang Update */
    }

    /* Áp dụng cho tất cả các nút */
    .btn {
        border-radius: var(--custom-radius);
    }

    /* (Tùy chọn) Bo góc cho Card nếu muốn đồng bộ */
    .card {
        border-radius: var(--custom-radius);
        overflow: hidden;
    }
    /* Giữ nguyên Style cũ của bạn */
    .avatar-profile-lg {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%);
        color: #3f51b5;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 2.5rem;
        margin: 0 auto 15px auto;
        border: 4px solid #fff;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .info-label {
        font-size: 0.8rem;
        font-weight: 700;
        color: #6c757d;
        text-transform: uppercase;
        margin-bottom: 8px;
        letter-spacing: 0.5px;
    }

    .info-value {
        font-size: 1rem;
        color: #343a40;
        font-weight: 500;
    }

    .card-user {
        border-radius: 12px;
        border: none;
        box-shadow: 0 0 20px rgba(0,0,0,0.05);
    }

    /* Badge cho danh mục */
    .badge-category {
        font-size: 0.85rem;
        padding: 5px 12px;
        border-radius: 15px;
        background-color: #e3f2fd;
        color: #1976d2;
        font-weight: 600;
        display: inline-block;
        margin-right: 5px;
        margin-bottom: 5px;
    }
</style>

<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6"><h1 class="m-0 text-dark font-weight-bold">Hồ sơ liên hệ</h1></div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a asp-action="Index">Danh bạ</a></li>
                    <li class="breadcrumb-item active">Chi tiết</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<section class="content">
    <div class="container-fluid">
        <div class="row">

            <div class="col-md-4 mb-3">
                <div class="card card-primary card-outline card-user">
                    <div class="card-body box-profile text-center pt-5 pb-4">
                        <div class="avatar-profile-lg">
                            @(Model.FullName?.Trim().Substring(0, 1).ToUpper() ?? "?")
                        </div>

                        <h3 class="profile-username text-center font-weight-bold">@Model.FullName</h3>

                        <div class="text-center mb-4">
                            @if (Model.CategoryNames != null && Model.CategoryNames.Any())
                            {
                                foreach (var name in Model.CategoryNames.Take(3))
                                {
                                    <span class="badge badge-light border mr-1">@name</span>
                                }
                            }
                            else
                            {
                                <span class="text-muted small">Chưa phân loại</span>
                            }
                        </div>

                        <div class="d-flex justify-content-center mb-4">
                            @if (!string.IsNullOrEmpty(Model.PhoneNumber))
                            {
                                <a href="tel:@Model.PhoneNumber" class="btn btn-app bg-light shadow-sm">
                                    <i class="fas fa-phone text-success"></i> Gọi điện
                                </a>
                            }
                            @if (!string.IsNullOrEmpty(Model.Email))
                            {
                                <a href="mailto:@Model.Email" class="btn btn-app bg-light shadow-sm">
                                    <i class="fas fa-envelope text-danger"></i> Gửi Mail
                                </a>
                            }
                        </div>

                        <div class="border-top pt-3 text-left">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted small"><i class="far fa-clock mr-1"></i> Ngày tạo</span>
                                <span class="text-dark small font-weight-bold">@Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-muted small"><i class="fas fa-history mr-1"></i> Cập nhật</span>
                                <span class="text-dark small font-weight-bold">
                                    @(Model.UpdatedAt.HasValue ? Model.UpdatedAt.Value.ToString("dd/MM/yyyy") : "---")
                                </span>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="col-md-8">
                <div class="card card-user h-100">
                    <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                        <h3 class="card-title text-primary font-weight-bold"><i class="fas fa-info-circle mr-1"></i> Thông tin chi tiết</h3>
                    </div>

                    <div class="card-body px-4">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="p-3 bg-light rounded h-100">
                                    <div class="info-label text-primary">Số điện thoại</div>
                                    <div class="info-value">
                                        @(string.IsNullOrEmpty(Model.PhoneNumber) ? "-- Trống --" : Model.PhoneNumber)
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="p-3 bg-light rounded h-100">
                                    <div class="info-label text-primary">Email</div>
                                    <div class="info-value">
                                        @(string.IsNullOrEmpty(Model.Email) ? "Chưa cập nhật" : Model.Email)
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 mb-3">
                                <div class="p-3 bg-light rounded">
                                    <div class="info-label text-primary"> Danh mục</div>
                                    <div class="info-value mt-2">
                                        @if (Model.CategoryNames != null && Model.CategoryNames.Any())
                                        {
                                            foreach (var name in Model.CategoryNames)
                                            {
                                                <span class="badge-category">@name</span>
                                            }
                                        }
                                        else
                                        {
                                            <span class="text-muted font-italic"><i class="far fa-circle mr-1"></i> Chưa cập nhật</span>
                                        }
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 mb-3">
                                <div class="p-3 bg-light rounded">
                                    <div class="info-label text-primary">Địa chỉ</div>
                                    <div class="info-value">
                                        @(string.IsNullOrEmpty(Model.Address) ? "Chưa cập nhật" : Model.Address)
                                    </div>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="info-label text-primary mb-2">Ghi chú</div>
                                <div class="p-3 rounded" style="background-color: #fff9c4; border-left: 5px solid #fbc02d; min-height: 80px;">
                                    @if (!string.IsNullOrEmpty(Model.Notes))
                                    {
                                        <p class="mb-0 text-dark" style="white-space: pre-line;">@Model.Notes</p>
                                    }
                                    else
                                    {
                                        <span class="text-muted font-italic">Chưa cập nhật</span>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card-footer bg-white border-top p-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <a asp-action="Index" class="btn btn-default">
                                <i class="fas fa-arrow-left mr-1"></i> Quay lại
                            </a>

                            <div>
                                <a asp-action="Update" asp-route-id="@Model.ContactId" class="btn btn-primary px-4 mr-2 shadow-sm">
                                    Cập nhật
                                </a>

                                <form asp-action="Delete" asp-route-id="@Model.ContactId" method="post"
                                      id="delete-form-@Model.ContactId" style="display: inline-block;">

                                    @Html.AntiForgeryToken()

                                    <button type="button" onclick="confirmDelete(@Model.ContactId)"
                                            class="btn btn-outline-danger px-4" title="Xóa">
                                        <i class="fas fa-trash-alt mr-1"></i> Xóa
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // Hàm xử lý khi bấm nút xóa
        function confirmDelete(contactId) {
            Swal.fire({
                title: 'Xóa liên hệ này',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Xóa',
                cancelButtonText: 'Hủy bỏ'
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('delete-form-' + contactId).submit();
                }
            })
        }

        @if (TempData["SuccessMessage"] != null)
        {
            <text>
                        Swal.fire({
                            icon: 'success',
                            title: 'Thành công!',
                            text: '@Html.Raw(TempData["SuccessMessage"])',
                            timer: 2000,
                            showConfirmButton: false
                        })
            </text>
        }
    </script>
}